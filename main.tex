\documentclass[11pt]{book}

% Book metadata
\title{Forest Vines to Snow Tussocks: The Story of New Zealand Plants}
\author{John Dawson}

% PACKAGE SECTION
% IMPORTANT PACKAGES
%
% Geometry - set the page size etc.
\usepackage{geometry}
\geometry{
  papersize={193mm,260mm},
  outer=4cm,
  inner=2cm,
  textheight=200mm,
  marginparwidth=3cm,
  marginparsep=3mm
}
% Load fonts
\usepackage[T1]{fontenc}
% Garamond Expert for roman font
\usepackage{ebgaramond}
% Biolinum as the sans font
\usepackage{biolinum}
% Allow using arbitrary font sizes - needed for the title page
\usepackage{anyfontsize}
% Subfiles - for the chapters
\usepackage{subfiles}

% REFERENCES
% Bibliography, index, references and URLs.
%
% Bibliography and citations - verbose (no Ibid). We'll configure citations to use the margins later and just use \cite.
\usepackage[style=verbose]{biblatex}
\addbibresource{bibliography.bib}
% Use nocite to include all the references from references.bib.
\nocite{allan1961, cockayne1928, cockayne1965, cooper1981, crookes1963, given1981,
        heath1974, johns1983, mark1979, moore1970, moore1978, poole1979, salmon1985,
        salmon1980, sampson1985}
\addbibresource{references.bib}
\DefineBibliographyStrings{english}{%
  bibliography = {References},
}
% Index creation
\usepackage{imakeidx}
\makeindex[columns=2, title=Index, intoc]
% Refer to sections using their name, not just number
\usepackage{hyperref}
% URL support, use sans font for urls
\usepackage{url}
\urlstyle{sf}
% Italicise a botanic name in the text and add it to the index.
% Optional arguments allow the name to be divided in the index, and have a
% different appearance to the text.
% \BotanicRef{Nothofagus} - both the text and index entry are Nothofagus
% \BotanicRef{N. menziesii}[Nothofagus][menziesii] - the text uses N. menziesii,
%     and the index is Nothofagus!menziesii.
\usepackage{xparse}
\DeclareDocumentCommand\BotanicRef{ m O{#1} o } {%
    \emph{#1}\index{\emph{#2}\IfNoValueF{#3}{!\emph{#3}}}%
}
% \itindex{Nothofagus}
% \itindex[australis]{Agathis}
\newcommand*{\itindex}[2][]{\textit{#2\ifx#1\empty\else{ #1}\fi}\index{#2@\textit{#2}\ifx#1\empty\else!\textit{#1}\fi}}
% Include an entry in the text and in the index.
\newcommand*{\nameindex}[2][]{#2\ifx#1\empty\else{ #1}\fi\index{#2\ifx#1\empty\else{ #1}\fi}}

% FIGURES
% Get a side captioned figure (SCfigure) and set the caption style.
\usepackage[outercaption]{sidecap}
\sidecaptionvpos{figure}{t}
\usepackage[font={small,it},labelfont=bf]{caption}
\usepackage{graphicx}
% Provides the wrapfig environment.
\usepackage{wrapfig}

% Prints a trailing space in a smart way.
\usepackage{xspace}

% HEADER AND FOOTER STYLES
\usepackage{fancyhdr}
% Suppress page numbers on chapter pages.
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[RE]{\sffamily\itshape\leftmark}% chktex 6
\fancyhead[LO]{\sffamily\itshape\rightmark}% chktex 6
% Page number
\fancyhead[LE,RO]{\sffamily\itshape\thepage}% chktex 6
\fancyfoot{}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
% Increase header height.
\setlength{\headheight}{25pt}

% TEXT LAYOUT
% Tables
% Better tables - span pages, allow auto-sizing multi-line columns and page breaks.
\usepackage{xltabular}
\usepackage{booktabs}
% Define a column type, R, that is the same as X but ragged right, and C which is centered
\usepackage{array}\newcolumntype{R}{>{\raggedright\arraybackslash}X}
\usepackage{array}\newcolumntype{C}{>{\centering\arraybackslash}X}
% CHAPTER AND SECTION STYLES
% We don't use titlesec because it doesn't handle multiple footnotes in
% the same heading. See https://github.com/jbezos/titlesec/issues/43
% Instead we'll define some custom commands.
\usepackage{sectsty}
\allsectionsfont{\mdseries\sffamily\itshape\raggedright}% chktex 6
% Set paragraph spacing.
\setlength{\parskip}{0.6em}
% Set spacing between list items.
\usepackage{enumitem}
\setlist{itemsep=0.5ex,parsep=0ex}
% Use marginnote package, redefine \footnote to use this. It works better than \footnotesinmargin for
% footnotes (citations) within tables and captions, and looks better than memoir's \marginpar.
% Yes it's unmaintained, when it breaks go back to footnotesinmargin and deal with it.
% We use this for captions, citations, footnotes, marginal notes and margin figures as well.
% MARGINAL NOTES
% We're going to put figure references into the margins.
\usepackage{marginnote}
\renewcommand*{\marginfont}{\footnotesize}
% Figure referencing. Can also use \nameref*{#1} to get the figure name. 
\newcommand{\fullref}[1]{\hyperref[{#1}]{\autoref*{#1}}}
\newcommand{\figureref}[1]{\marginnote{\emph{See #1}}}
% Place footnotes at the bottom of the page (i.e., not directly under text, as we use \raggedbottom),
% and provide commas between the references if there are multiple footnotes.
\usepackage[bottom,multiple]{footmisc}
% Force content to next left page. Use this to force content to face a chapter.
\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\newpage\fi
}

% MISC
% Macros for typesetting the documentation
\usepackage{xcolor}
\newcommand{\correction}[1]{\textcolor{red}{#1}}
% \newcommand{\hangleft}[1]{\makebox[0pt][r]{#1}}
\newcommand{\hairsp}{\hspace{1pt}}% hair space
\newcommand{\hquad}{\hskip0.5em\relax}% half quad space
\newcommand{\ie}{\textit{i.\hairsp{}e.}\xspace}
\newcommand{\eg}[0]{\textit{e.\hairsp{}g.}\xspace}
% Macro for the correct accent for Hawai'i
\DeclareRobustCommand{\okina}{%
  \raisebox{\dimexpr\fontcharht\font`A-\height}{%
    \scalebox{0.8}{`}%
  }%
}

%% END OF CONFIGURATION
%% START OF DOCUMENT
\begin{document}
% Don't expand text to fill the page.
\raggedbottom%

% Front matter
\frontmatter

% Custom title page
\makeatletter
{
    \thispagestyle{empty}
      \begin{raggedright}
        % \itshape
        \fontsize{24}{30}\selectfont
        {\@author\ \par}
        \vfill
        {\fontsize{44}{55}\selectfont Forest Vines to Snow Tussocks\par}
        {\scshape \sffamily The Story of New Zealand Plants \par}
        \vfill
        \vfill
        \vskip 3em
      \end{raggedright}\par
      \vfill\null\
}
\makeatother
\clearpage
\subfile{copyright}
\cleardoublepage%
\renewcommand{\baselinestretch}{0.5}\normalsize%
\tableofcontents
\renewcommand{\baselinestretch}{1.0}\normalsize%
\cleardoublepage%
\subfile{preface}
\mainmatter%
\subfile{book}
% The back matter contains appendices, bibliographies, indices, glossaries, etc.
\backmatter%
\printbibliography[heading=bibintoc]
% Set the heading otherwise the previous chapter heading leaks.
\markboth{Index}{Index}
\printindex

\end{document}
